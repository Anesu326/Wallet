<!DOCTYPE html>
<html>
    <head>
        <title>Dashboard</title>
        <style>
        body{
            font-family: Arial, sans-serif;
            margin: 30px;
        }

        .dashboard-grid{
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        .box{
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #fdfdfd;
        }
        table{
            width: 100%;
            border-collapse: collapse;
            text-align: left;
        }
        h2, h3{
            margin-top:0;
        }
    </style>
    </head>

    <body>      
    <h2>Welcome, {{ request.user.first_name|default:request.user.username }}</h2>
    <form method="post" id="sendForm">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit">Send</button>
    </form>

    <h3>Sponsored Ads</h3>
    <div id="adCarousel" style="width: 100%; max-width: 600px; overflow: hidden; border: 1px solid #ccc; border-radius: 8px; position: relative; margin-bottom: 20px;">
        <div id="adInner" style="display: flex; width: 200%; transition: transform 0.5s ease;">
            <div style="width:100%; flex-shrink:0; padding: 20px; background: #f9f9f9;">
                <h4>Ad 1: Money Transfare Bonus</h4>
                <p>Send 500+ and get 10 cashback instantly. Limited time offer!</p>
            </div>
            <div style="width:100%; flex-shrink:0; padding: 20px; background: #f0f0f0;">
                <h4>Ad 2: Refer a Friend</h4>
                <p>Earn rewards when your friends use this App to send money abroad.</p>
            </div>
        </div>
    </div>

    <script>
        let currentAd = 0;
        const adInner = document.getElementById("addInner");
        setInterval(() => {
            currentAd = (currentAd + 1) % 2;
            adInner.style.transform = `translateX(-${currentAd * 100}%)`;
        }, 4000);

        window.onload = function(){
            document.getElementById('receiptModal').style.display = 'block';
        };

        function closeReceipt(){
            document.getElementById("receiptModal").style.display = "none"
            document.getElementById("sendForm").reset();
        }
    </script>

    {% if result %}    
    <div id="receiptModal" style="display: none; position: fixed; top: 0; left:0; width: 100%; height: 100%; background-color: aquamarine;">
        <div style="background: white; margin: 10% auto; padding: 20px; width: 400px; border-radius: 8px; position: relative;">
            <span onclick="closeReceipt()" style="position:absolute; top:10px; right:15px; cursor: pointer;">&times;</span>
            <h3>Receipt</h3>
            <p><strong>To:</strong>{{ result.receiver_name }} ({{ result.receiver_email }})</p>
            <p><strong>Sent:</strong>{{ result.amount }} USD</p>
            <p><strong>Fee:</strong>{{ result.fee }} USD</p>
            <p><strong>Exchange Rate:</strong>{{ result.rate }}</p>
            <p><strong>Received:</strong>{{ result.final }} {{ result.currency}} USD</p>
            <p><strong>Time:</strong>{{ result.timestamp|date:"Y-m-d H:i" }}</p>
        </div>
    </div>    
    {% endif %}    

     <h2>Recent Transactions</h2>
    <table border="1">
        <tr>
            <th>Date</th>
            <th>Receiver</th>
            <th>Amount</th>
            <th>Currency</th>
            <th>Fee</th>
            <th>Received</th>
        </tr>
        {% for t in transactions %}
        <tr>
            <td>{{ t.timestamp|date:"Y-m-d H:i" }}</td>
            <td>{{ t.receiver_name }}</td>
            <td>{{ t.amount_usd }}</td>
            <td>{{ t.currency }}</td>
            <td>{{ t.fee }}</td>
            <td>{{ t.final_amount }} {{  t.currency }}</td>            
        </tr>
        {% empty %}
        <tr><td colspan="6">No transactions yet</td></tr>
        {% endfor %}
    </table>
    </body>
</html>